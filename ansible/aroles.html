
<!DOCTYPE html>
<html lang="en">
  <head>
	 <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
       <meta name="viewport" content="width=device-width, initial-scale=1">

    	 <!-- Copy this two files and save them in the dir named js -->
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
  	<script src="http://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/js/bootstrap.min.js"></script> 
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <!-- Meta tag provides the information about the html document -->

    <meta name="description" content="its about linux and devops tools">
    <meta name="author" content="Bikram Bhandari">
    <link rel="icon" href="../../favicon.ico">

    <title>Ansible </title>

    <!-- Bootstrap core CSS -->
    <link href="../css/bootstrap.min.css" rel="stylesheet">
    
   <!-- Custom styles for this template which is defined in the css folder-->
    <link href="../css/justified-nav.css" rel="stylesheet">
   <link href="../css/home.css" rel="stylesheet">
   <link href="../css/command.css" rel="stylesheet">

<!--just for debugging purposes. Don't actually copy these 2 lines! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
    <script src="js/ie-emulation-modes-warning.js"></script>

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
  <![endif]--> 
 </head>

  <body>

    <!-- Script to connect to fb-->
  <div id="fb-root"></div>
<script>(function(d, s, id) {
  var js, fjs = d.getElementsByTagName(s)[0];
  if (d.getElementById(id)) return;
  js = d.createElement(s); js.id = id;
  js.src = "//connect.facebook.net/en_US/sdk.js#xfbml=1&version=v2.10";
  fjs.parentNode.insertBefore(js, fjs);
}(document, 'script', 'facebook-jssdk'));</script>

    <div class="container">

      <!-- The justified navigation menu is meant for single line per list item.
           Multiple lines will require custom code not provided by Bootstrap. -->
      <div class="masthead">
        <h3 class="text-muted title">Ping Linux</h3>
       <div class="bs-example">
	<nav >
          <ul class="nav nav-justified nav-pills" role="tablist">
	    <li class="active active badge"><a href="../index.html">Home</a></li>
	    <!----submenu in the contents ------->
 
	    <li class="dropdown active badge col-md-6"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Contents<b class="caret"></b></a>
			<ul class="dropdown-menu col-xs-12" role="menu" style="text-align:center;">

                            <li><a href="../contents/introtolinux.html">Into to Linux</a></li>
                            <li><a href="../contents/filemanagement.html">File management</a></li>
                            <li><a href="../contents/textediting.html">Text Editing & processing</a></li>
                            <li class="divider"></li>
                            <li><a href="../contents/filepermissions.html">File Permissions,Users and Groups</a></li>
			    <li><a href="../contents/packageinstall.html">Package Install and  Management</a></li>
                            <li><a href="../contents/processmanagement.html">Process Management</a></li>
			    <li><a href="../contents/networkutilities.html">Network Utilities</a></li>
			    <li><a href="../contents/compressedfiles.html">Compressed Files & logging</a></li>
			    <li><a href="../contents/filestransfer.html">Files transfer</a></li>
			    <li><a href="../contents/firewall.html">Firewalls and Security </a></li>
			</ul>
                    </li>
		<li class="dropdown active badge col-md-6"><a href="#" data-toggle="dropdown" class="dropdown-toggle">Devops<b class="caret"></b></a> 
			<ul class="dropdown-menu col-xs-12" role="menu" style="text-align:center;">
			<li><a href="../vagrant/vagrant.html">Vagrant</a></li>                                                     <li class="divider"></li>
                                <li><a href="../devops/puppet.html">Puppet</a></li>
                                <li class="divider"></li>
                                <li><a href="../ansible/ansible.html"> Ansible</a></li>
                                <li class="divider"></li>
                                <li><a href="../git/git.html">Git</a></li>
			</ul>
	    </li>	
            <li class="active badge"><a href="../contact.html">Contact</a></li>
	</ul>
        </nav>
      </div>
     </div>
    <script async src="//pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>
<!-- top -->
<ins class="adsbygoogle"
     style="display:inline-block;width:728px;height:90px"
     data-ad-client="ca-pub-5629969818459684"
     data-ad-slot="2973793853"></ins>
<script>
(adsbygoogle = window.adsbygoogle || []).push({});
</script> 
      <!-- Example row of columns -->
      <div class="row">
        <div class="col-lg-7">
          <h2>Ansible Roles</h2>
            <!-- Display fb button here -->
                      <div style="display: block;text-align: right;" class="fb-share-button" data-href="http://www.pinglinux.com/ansible/aroles.html" data-layout="button" data-size="large" data-mobile-iframe="true"><a class="fb-xfbml-parse-ignore" target="_blank" href="https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.pinglinux.com%2F&amp;src=sdkpreparse">Share</a></div>
	   <hr></hr>
          <p class="text-danger bluefont">What is Roles?</p>
          <p class="pfont">It is the upper level abstraction in the playbooks to better organize the playbook.Playbook gets bulky and mess when there are few play on it.Thus, roles is used to address this problem. we have to specify the path for roles before using it. </p>
	    <pre>$ cat /etc/anisble/ansible.cfg
add  /etc/anisble/roles </pre>
	  </div>
	</div>

	<div class="row">
	  <div class="col-lg-6">
           <p class="bluefont">Ways to organize the playbook into Roles</p>
		<p class="pfont">vi nginx-playbook.yml
		<pre>
---
# yml file to install nginx
- hosts: all
  vars:
  - home_dir: /var/www/pinglinux/html/

  tasks:
  - name: Install nginx
    yum: pkg=nginx state=installed
    notify:
    - start nginx

  - name: create home directory
    file: dest={{ home_dir  }} mode=777 state=directory owner=root group=root
    register: index
    notify:
    - restart nginx

  - name: Upload the index.html to the pinglinux/html directory
    copy: src=index.html dest=/var/www/pinglinux/html/ mode=677
    notify:
    - restart nginx
    when: index|success

  handlers:
  - name: start nginx
    service: name=nginx state=started

  - name: restart nginx
    service: name=nginx state=restarted

		</pre>
	 	</div>
 
	<div class="col-lg-6">
	   <p class="bluefont">Structure of the Roles. </br></p>
	  <p class="pfont">Create the directory name roles, And have the simlilar structure as below. </p>
	   <pre>roles/mysql/{tasks,handlers,meta,vars,templates,files}
roles/nginx/tasks/main.yml
roles/nginx/handlers/main.yml
roles/nginx/meta/main.yml
roles/nginx/vars/main.yml
roles/nginx/templates/name.j2
roles/nginx/files/Name_OF_file
nginx_playbook.yml</pre>
	  <p class="pfont"> Lets explain the directories 
	  <ul>
	  <li>tasks: it contains all the task that play book would have had.</li>
	  <li>handlers: it contains all the handlers that playbook would have had.</li>
          <li>vars:    it contains all the variable that playbook would have had.</li>
	  <li>meta: it contains the list of roles that must be applied before current role.</li>
          <li>files: it contains all the files that needs to get transferred to the hosts.</br></li></ul></p>
        </div>
      </div>

	<h2> Lets split the above playbook into Roles </h2>
	<hr> </hr>
	<div class="row">
          <div class="col-lg-6">
           <p class="bluefont"> Tasks</p>
	   <pre>vi /anisble/roles/nginx/tasks/main.yml </pre>
<pre>
---
  - name: Install nginx
    yum: pkg=nginx state=installed
    notify:
    - start nginx

  - name: create home directory
    file: dest={{ home_dir  }} mode=777 state=directory owner=root group=root
    register: index
    notify:
    - restart nginx

  - name: Upload the index.html to the pinglinux/html directory
    copy: src=index.html dest=/var/www/pinglinux/html/ mode=677
    notify:
    - restart nginx
    when: index|success
</pre>	   </div>
          <div class="col-lg-6">
           <p class="bluefont">Handlers </p>
	   <pre>vi /anisble/roles/nginx/handlers/main.yml</pre>
	   <pre>
---
- name: start nginx
  service: name=nginx state=started

- name: restart nginx
  service: name=nginx state=restarted		
	   </pre> 
	  </div>
	 </div>

	 <div class="row">
          <div class="col-lg-6">
           <p class="bluefont"> Vars </p>
	   <pre>vi /anisble/roles/nginx/vars/main.yml</pre>
	   <pre>
---
- home_dir: /var/www/pinglinux/html/
	   </pre>
          </div>
          <div class="col-lg-6">
           <p class="bluefont"> Meta </p>
           <p class="pfont">If this role had depended on mysql role.And assuming we had already made the mysql role inside the roles directory </p>
	   <pre>vi /anisble/roles/nginx/meta/main.yml </pre>
          <pre>
---
dependencies:
- { role: mysql }
         </pre>           
	  </div>
         </div>


	  <div class="row">
          <div class="col-lg-6">
           <p class="bluefont">Files </p>
	  <pre>vi /anisble/roles/nginx/files/index.html </pre>
	   <pre>
Hello World !!!
	   </pre>	 
           </div>
          <div class="col-lg-6">
           <p class="bluefont">Templates</p>
            <p class="pfont">You can store the files either in files directory or templates directory </p>
	  <pre>vi /anisble/roles/nginx/templates/file.j2 </pre>
	  <p class="pfont">template: src=index.j2 dest=/var/www/pinglinux/html/index.html mode=677 </p>
	  <pre> it will grab the index.j2 file from template directory inside the nginx directory </pre>
           </div>
         </div>

	  <div class="row">
          <div class="col-lg-6">
	   <p class="bluefont">vi nginxPlaybook.yml  </p>
            <pre>
---
- hosts: all
  
  roles:
  - nginx
          </pre>       
	    <p class="bluefont">if we had multiple roles, we can list all of them as follow </p>
            <pre>
---
- hosts: all

  roles:
  - nginx
  - php
  - mysql
          </pre>    

	    </div>
          <div class="col-lg-6">
           <p class="bluefont">Running the playbook </p>
	   <pre>ansible-playbook nginxPlaybook.yml -i hosts </pre>
	   <img src="../ansiblepict/roles.png" alt="roles" style="width:100%;height:100%;">
           </div>
         </div>

	<nav>
  		<ul class="pager button active">
    			<li><a href="atemplates.html"><span aria-hidden="true">&larr;</span>Previous</a></li>
    			<!--<li><a href="amodule.html">Next<span aria-hidden="true">&rarr;</span></a></li>-->
  		</ul>
	</nav>
     <hr></hr>
 </div>
  </div> <!-- /container -->
  <!-- Jumbotron -->
      <div class="jumbotron footerdev">
        <h1>Smart Technology begins here!!</h1>
        <p> Welcome to the site. Here you can find useful information about linux command, there usages, as well as the devops tools and the installation process.</p>
        <p><a class="btn btn-primary " href="#" role="button">Get started today</a></p>
      </div>
<!-- Site footer -->

      <footer class="footer copyright">
        <p>&copy; Pinglinux 2014</p>
      </footer>

    
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="../../assets/js/ie10-viewport-bug-workaround.js"></script>
  </body>
</html>
